---
title: 量化交易云服务器维护小技巧
date: 2023-03-25 18:00:00
tags: 
    - 资源
categories:
    - 量化
    - 运维
---

> 量化交易中经常涉及到云服务器的使用，本文分享Windows机器和Linux机器中几个使用小技巧。


# Windows机器
## RDP端口

RDP是Windows自带的远程访问协议，默认端口是3389，会常常有大量的黑客破解活动，严重影响系统的安全性和稳定性：

![](/img/rdp_failure.png)

一个有效的阻断方式是，除了加强密码复杂度外，换一个不常用的大数字RDP端口，例如以下Powershell脚本，将端口换成33389，同时在云服务器的安全组中禁用3389访问，添加一条33389：

```powershell
$portvalue = 33389

Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -name "PortNumber" -Value $portvalue 

New-NetFirewallRule -DisplayName 'RDPPORTLatest-TCP-In' -Profile 'Public' -Direction Inbound -Action Allow -Protocol TCP -LocalPort $portvalue 
New-NetFirewallRule -DisplayName 'RDPPORTLatest-UDP-In' -Profile 'Public' -Direction Inbound -Action Allow -Protocol UDP -LocalPort $portvalue
```

换了端口后，再次查看事件查看器，会发现世界一下子清净了很多。

## 禁用Defender安全扫描
观察资源管理器有时会发现`Defender`消耗了大量的资源，如果云主机性能有限的话，容易出现卡顿。在设置好云服务器的防火墙或安全组后，完全可以将这个组件卸载，提升系统性能：

```powershell
Remove-WindowsFeature Windows-Defender
```

在powershell中设置后重启便会生效。

## 安装WSL

Windows Server 2022中可以直接基于命令行安装WSL，设置好虚拟化条件后
- 首先下载一个最新的Ubuntu-WSL镜像： http://cloud-images.ubuntu.com/wsl/jammy/current/
- 使用导入的方式安装镜像：`wsl –import <Image Name you choose> <Directory to store and run the image> <Directory location of the exported .tar file>`
  
# Linux机器
## SSH端口

Linux 机器也一样，默认的22端口非常容易受到外部扫描器暴力破解攻击，我们完全可以修改22端口到一个不常见的端口：
- vim /etc/ssh/sshd_config
- 添加一行：Port xxxxx

然后在防火墙设置中放行xxxxx入端口：
![](/img/SSH.png)

最后重启SSH服务： `sudo service sshd restart`

如果还存在大量的暴力破解，还可以有以下方式缓解：
- fail2ban，阻断攻击IP
- 禁用SSH密码登录，仅允许证书登录等

## 端口复用

端口复用指的是同一个端口根据不同的请求包特征转发到不同的服务上，比如443端口通常是HHTPS访问的默认端口，我们也可以把它配置成SSH、Clickhouse等应用的端口，减少服务器的端口暴露风险。端口复用的方案比较多，这里推荐两个：

- nginx stream方案
- sslh方案(https://github.com/yrutschle/sslh)